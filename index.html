<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Simulation Chirurgie Réfractive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f5f7fa;
      --card: #fff;
      --primary: #4f46e5;
      --text: #1e293b;
      --text-muted: #475569;
      --border: #cbd5e1;
      --input-bg: #f1f5f9;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --radius: 12px;
      --gap: 1rem;
      --transition: 0.2s;
      --icon-size: 1rem;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); }
    h1 { text-align: center; padding: var(--gap) 0; font-size: 1.75rem; color: var(--text-muted); }
    .container { max-width: 900px; margin: auto; padding: var(--gap); }
    .panels { display: flex; gap: var(--gap); flex-wrap: wrap; }
    .panel { flex: 1 1 45%; background: var(--card); border-radius: var(--radius);
      box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: var(--gap); position: relative; }
    .panel-title { color: var(--primary); font-size: 1.25rem; font-weight: 600; margin-bottom: 0.75rem; }
    form { display: grid; gap: var(--gap); }
    .field { position: relative; display: flex; flex-direction: column; }
    .field label { font-size: 0.95rem; color: var(--text-muted); margin-bottom: 0.25rem; }
    .field input { padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius);
      background: var(--input-bg); font-size: 1rem; color: var(--text); transition: border-color var(--transition); }
    .field input:focus { outline: none; border-color: var(--primary); }
    .field .icon { position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%);
      font-size: var(--icon-size); }
    .radio-group { display: flex; gap: 1rem; }
    .radio-group label { display: flex; align-items: center; gap: 0.25rem; color: var(--text-muted); }
    .slider { display: flex; align-items: center; gap: 0.5rem; }
    .slider span { width: 2.5rem; text-align: center; font-size: 0.95rem; }
    .anis { margin: var(--gap) auto; max-width: 300px; background: var(--card); padding: var(--gap);
      border-radius: var(--radius); box-shadow: 0 2px 8px rgba(0,0,0,0.04); text-align: center; }
    .anis label { display: block; margin-bottom: 0.5rem; color: var(--text-muted); }
    .anis input { width: 100%; padding: 0.5rem; border: 1px solid var(--border);
      border-radius: var(--radius); background: var(--input-bg); text-align: center; }
    .actions { text-align: center; margin: var(--gap) 0; }
    button { background: var(--primary); color: #fff; border: none; border-radius: var(--radius);
      padding: 0.75rem 1.5rem; font-size: 1rem; cursor: pointer; transition: background var(--transition); }
    button:hover { background: #3730a3; }
    @media (max-width: 600px) { .panels { flex-wrap: nowrap; } .panel { flex: 1 1 50%; } form { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Simulation Chirurgie Réfractive</h1>
    <div class="panels">
      <!-- OD -->
      <div class="panel">
        <div class="panel-title">Œil Droit (OD)</div>
        <form id="od">
          <div class="field"><label>Sphère</label><input id="od-sphere" type="number" step="0.25"><span class="icon" id="icon-od-sphere"></span></div>
          <div class="field"><label>Cylindre</label><input id="od-cylinder" type="number" step="0.25"><span class="icon" id="icon-od-cylinder"></span></div>
          <div class="field"><label>Éq. sphérique</label><input id="od-equiv" readonly><span class="icon" id="icon-od-equiv"></span></div>
          <div class="field"><label>Pachymétrie</label><input id="od-pachy" type="number"><span class="icon" id="icon-od-pachy"></span></div>
          <div class="field"><label>Kmin</label><input id="od-kmin" type="number" step="0.01"><span class="icon" id="icon-od-kmin"></span></div>
          <div class="field"><label>Kmax</label><input id="od-kmax" type="number" step="0.01"><span class="icon" id="icon-od-kmax"></span></div>
          <div class="field"><label>Pupille</label><input id="od-pupille" type="number" step="0.1"><span class="icon" id="icon-od-pupille"></span></div>
          <div class="radio-group">
            <label><input name="od-tech" type="radio" value="lasik" checked>Lasik</label>
            <label><input name="od-tech" type="radio" value="pkr">PKR</label>
            <label><input name="od-tech" type="radio" value="mito">PKR mito</label>
          </div>
          <div class="slider"><label>Zone optique</label><input id="od-zone" type="range" min="60" max="85" step="5"><span id="od-zone-label"></span></div>
          <div class="slider"><label>Capot</label><input id="od-capot" type="range" min="0" max="2" step="1"><span id="od-capot-label"></span></div>
          <div class="field"><label>Ablation centrale</label><input id="od-ablation" readonly><span class="icon" id="icon-od-ablation"></span></div>
          <div class="field"><label>K post-op</label><input id="od-kpost" readonly><span class="icon" id="icon-od-kpost"></span></div>
          <div class="field"><label>Mur LASIK</label><input id="od-mur-lasik" readonly><span class="icon" id="icon-od-mur-lasik"></span></div>
          <div class="field"><label>PTA LASIK</label><input id="od-pta-lasik" readonly><span class="icon" id="icon-od-pta-lasik"></span></div>
          <div class="field"><label>Mur PKR</label><input id="od-mur-pkr" readonly><span class="icon" id="icon-od-mur-pkr"></span></div>
          <div class="field"><label>PTA PKR</label><input id="od-pta-pkr" readonly><span class="icon" id="icon-od-pta-pkr"></span></div>
        </form>
      </div>
      <!-- OG -->
      <div class="panel">
        <div class="panel-title">Œil Gauche (OG)</div>
        <form id="og">
          <div class="field"><label>Sphère</label><input id="og-sphere" type="number" step="0.25"><span class="icon" id="icon-og-sphere"></span></div>
          <div class="field"><label>Cylindre</label><input id="og-cylinder" type="number" step="0.25"><span class="icon" id="icon-og-cylinder"></span></div>
          <div class="field"><label>Éq. sphérique</label><input id="og-equiv" readonly><span class="icon" id="icon-og-equiv"></span></div>
          <div class="field"><label>Pachymétrie</label><input id="og-pachy" type="number"><span class="icon" id="icon-og-pachy"></span></div>
          <div class="field"><label>Kmin</label><input id="og-kmin" type="number" step="0.01"><span class="icon" id="icon-og-kmin"></span></div>
          <div class="field"><label>Kmax</label><input id="og-kmax" type="number" step="0.01"><span class="icon" id="icon-og-kmax"></span></div>
          <div class="field"><label>Pupille</label><input id="og-pupille" type="number" step="0.1"><span class="icon" id="icon-og-pupille"></span></div>
          <div class="radio-group">
            <label><input name="og-tech" type="radio" value="lasik" checked>Lasik</label>
            <label><input name="og-tech" type="radio" value="pkr">PKR</label>
            <label><input name="og-tech" type="radio" value="mito">PKR mito</label>
          </div>
          <div class="slider"><label>Zone optique</label><input id="og-zone" type="range" min="60" max="85" step="5"><span id="og-zone-label"></span></div>
          <div class="slider"><label>Capot</label><input id="og-capot" type="range" min="0" max="2" step="1"><span id="og-capot-label"></span></div>
          <div class="field"><label>Ablation centrale</label><input id="og-ablation" readonly><span class="icon" id="icon-og-ablation"></span></div>
          <div class="field"><label>K post-op</label><input id="og-kpost" readonly><span class="icon" id="icon-og-kpost"></span></div>
          <div class="field"><label>Mur LASIK</label><input id="og-mur-lasik" readonly><span class="icon" id="icon-og-mur-lasik"></span></div>
          <div class="field"><label>PTA LASIK</label><input id="og-pta-lasik" readonly><span class="icon" id="icon-og-pta-lasik"></span></div>
          <div class="field"><label>Mur PKR</label><input id="og-mur-pkr" readonly><span class="icon" id="#icon-og-mur-pkr"></span></div>
          <div class="field"><label>PTA PKR</label><input id="og-pta-pkr" readonly><span class="icon" id="icon-og-pta-pkr"></span></div>
        </form>
      </div>
    </div>
    <div class="anis">
      <label>Différence Éq. sphérique</label>
      <input id="anisometropie" readonly>
    </div>
    <div class="actions"><button id="reset">Réinitialiser</button></div>
  </div>
  <script>
    const icons = { success: '✓', warning: '•', danger: '✕' };
    function applyIcon(id, level) {
      const ico = document.getElementById('icon-' + id);
      if (ico) { ico.textContent = level ? icons[level] : ''; ico.className = 'icon ' + (level || ''); }
    }
    function getVal(id) { const v = document.getElementById(id).value.replace(',', '.'); return v === '' ? NaN : parseFloat(v); }
    function getCentralAbl(s, c) {
      const table = {
        '-1|0':22,'-2|0':38,'-3|0':54,'-4|0':70,'-5|0':86,'-6|0':101,'-7|0':117,'-8|0':133,'-9|0':148,'-10|0':164,
        '-1|-1':36,'-2|-1':52,'-3|-1':68,'-4|-1':84,'-5|-1':100,'-6|-1':116,'-7|-1':132,'-8|-1':148,'-9|-1':164,'-10|-1':180,
        '-1|-2':50,'-2|-2':66,'-3|-2':82,'-4|-2':98,'-5|-2':114,'-6|-2':130,'-7|-2':146,'-8|-2':162,'-9|-2':178,'-10|-2':194
      };
      const key = `${-Math.abs(Math.round(s))}|${Math.round(c)}`;
      return table[key] || Math.round(20 + 16 * Math.abs(s) + 8 * Math.abs(c));
    }
    function getThresh(id) {
      const map = {
        'pachy':{danger:x=>x<470||x>700,warning:x=>x<500||x>650},
        'kmin':{danger:x=>x<39||x>49,warning:x=>x<41||x>47},
        'kmax':{danger:x=>x<40||x>56,warning:x=>x<43||x>54},
        'pupille':{danger:x

